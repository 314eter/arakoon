
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Arakoon :: Managing Arakoon</title>
    <meta name="description"
      content="Arakoon is a distributed, consistent key-value store">
    <meta name="author" content="Incubaid BVBA">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="../bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="../style.css" rel="stylesheet" />
    <link href="../code.css" rel="stylesheet" />

    <!-- TODO
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->


  </head>

  <body class='page-documentation_managing_arakoon'>

    <header>
    <div class="topbar">
      <div class='container'>
        <a href='index.html'>
            <img alt='Arakoon' title='Arakoon Logo' src='../img/logo.png' id='logo' />
        </a>
      </div>

      <div class="fill">
        <div class="container">
        <nav>
          <ul class="nav">
            <li>
            <a href="../index.html">Home</a>
            </li>
            <li>
            <a href="../download.html">Download</a>
            </li>
            <li>
            <a href="../documentation/index.html">Documentation</a>
            </li>
            <li>
            <a href="../contact.html">Contact</a>
            </li>
          </ul>
        </nav>
        </div>
      </div>
    </div>
    </header>

    <div class="container" id='main'>
      
<div class="document" id="managing-arakoon">
<h1 class="title">Managing Arakoon</h1>

<p>In this section you can find the basic commands to manage Arakoon.</p>
<div class="section" id="creating-a-cluster">
<h2>Creating a Cluster</h2>
<p>After the installation of Arakoon via its <a class="reference external" href="installing_arakoon.html">debian package</a>, you can create an
Arakoon configuration file anywhere on your harddisk. By default Arakoon looks
for the configuration file cfg/arakoon.ini, relative to the current working
directory. If you want to use another location and name for the configuration
file, you must use the -config argument with the arakoon command.</p>
<p>To create a cluster, you have to define the whole cluster and its nodes in a
<a class="reference external" href="arakoon_configuration.html">configuration file</a>. For an example, see the <a class="reference external" href="arakoon_deployment.html">Arakoon Deployment page</a>.</p>
<p>The defined directories in the configuration file must be created before you
can continue with Arakoon. If directories are missing, you get errors when
starting an Arakoon node.</p>
</div>
<div class="section" id="starting-a-node">
<h2>Starting a Node</h2>
<p>Once you have created the configuration file, you can start one or more nodes.
In the further documentation on this page, the Arakoon configuration file is
stored in /root/cfg/my_cluster.cfg and the working directory is /root.</p>
<p>To start a node 'Node_0' on Machine 1:</p>
<pre class="literal-block">
arakoon -daemonize -config /root/cfg/my_cluster.cfg --node Node_0
</pre>
<p>If you don't want to use the -config parameter, the Arakoon configuration file
must be arakoon.ini and must be located in the cfg directory in your current
working directory. In this example this would mean that you only need to rename
my_cluster.cfg to arakoon.ini.</p>
<p>To make your cluster work, you have to copy the configuration file to your
other machines, which also have Arakoon installed. Then start another node of
the cluster. Once there are two nodes up, you can start using the Arakoon
cluster.</p>
<div class="alert-message block-message warning important">
<p class="first admonition-title"><strong>Important</strong></p>
<p class="last">When you run Arakoon as daemon, you must use an absolute path to the
configuration file.</p>
</div>
</div>
<div class="section" id="adding-a-learner-node">
<h2>Adding a Learner Node</h2>
<p>If you want to add a Learner Node (see also <a class="reference external" href="pylabs/configuring_arakoon.html">Configuring Arakoon</a>), you have
to modify the Arakoon configuration file. Do not add the learner node to the
list of nodes in the cluster, just define the learner.</p>
<p>In the definition of the Learner node you must indicate that the node is a
learner and from which targets it must learn. The other parameters are similar
to a normal node.</p>
<div class="alert-message block-message warning important">
<p class="first admonition-title"><strong>Important</strong></p>
<p class="last">Do not forget to update all the configuration files of your cluster.</p>
</div>
<pre class="literal-block">
[Learner_0]
ip = 192.168.1.100
client_port = 7180
messaging_port = 10100
home = /tmp/learner_0
log_dir = /tmp/learner_0
learner = true
targets = Node_0, Node_1, Node_2
log_level = debug
</pre>
<p>Start a learner node the same way as a <a class="reference internal" href="#starting-a-node">normal node</a>.</p>
<pre class="literal-block">
arakoon -daemonize -config /root/cfg/my_cluster.cfg --node Learner_0
</pre>
</div>
<div class="section" id="master-node">
<h2>Master Node</h2>
<p>In some cases it is useful to select an Arakoon node to be the master node,
see also <cite>Cluster Nodes</cite>. To do so, add a master argument in the [global]
section of the configuration file. To have a backup in case the defined master
node is down, add an extra parameter preferred_master. The other nodes start
negotiating to become master in case the defined master is down.</p>
<pre class="literal-block">
[global]
cluster=Node_0, Node_1, Node_2
master=Node_0
preferred_master=true
</pre>
</div>
<div class="section" id="cloning-a-node">
<h2>Cloning a Node</h2>
<p>When you intend to grow your cluster, it might be interesting to clone the
existing node prior to changing the cluster configuration. Once the cluster
configuration is changed to two nodes, both nodes need to accept an update
before it will be accepted. If the first node contains a lot of data, the
second node must perform a large catchup operation (to make it in sync with the
original node). To minimize the catchup window, you can clone the first node in
the cluster before the configuration is changed. This way the catchup procedure
is limited to the updates that were added since the moment of cloning.</p>
<p>To add a clone, add a new node to the configuration file and start it this
way:</p>
<pre class="literal-block">
arakoon -config /root/cfg/my_cluster.cfg --node Node_4 -catchup-only
</pre>
<div class="alert-message block-message warning important">
<p class="first admonition-title"><strong>Important</strong></p>
<p class="last">Make sure that the node is added to the cluster parameter in the
configuration file.</p>
</div>
<p>When the cloning is finished, you can start the new node as a normal node. To
clone a node via the Arakoon PyLabs client see <a class="reference external" href="pylabs/cloning_a_node.html">Cloning a Node</a>.</p>
</div>
<div class="section" id="collapsing-tlogs">
<h2>Collapsing TLogs</h2>
<p>When the number of updates is higher than the number of additions, the
collection of TLogs keeps on growing. You can however reduce the space needed
on disk if you collapse old TLogs into a head database.</p>
<p>To collapse the TLogs:</p>
<pre class="literal-block">
arakoon --collapse &lt;tlog_dir&gt; &lt;n&gt;
</pre>
<p>Where the &lt;tlog_dir&gt; is defined in the Arakoon configuration file and &lt;n&gt; is
the number of TLogs that must remain. For example when you have 40 TLog files
in /tmp/Node_0 and you want to keep the five most recent TLogs, run this
command:</p>
<pre class="literal-block">
arakoon --collapse /tmp/Node_0 5
</pre>
</div>
<div class="section" id="investigating-tlogs">
<h2>Investigating TLogs</h2>
<p>It is not possible to read TLogs as stored on the file system. If you want
human-readable output, you need a dump of the TLog.</p>
<pre class="literal-block">
arakoon --dump-tlog &lt;path_to_tlog_file&gt;
</pre>
<p>For example:</p>
<pre class="literal-block">
arakoon --dump-tlog /opt/qbase5/var/db/mycluster/mycluster_0/000.tlog
0:MasterSet ;"mycluster_0";0
1:MasterSet ;"mycluster_0";0
2:MasterSet ;"mycluster_0";0
3:MasterSet ;"mycluster_0";0
4:MasterSet ;"mycluster_0";0
5:MasterSet ;"mycluster_0";0
6:MasterSet ;"mycluster_0";0
7:MasterSet ;"mycluster_0";0
8:MasterSet ;"mycluster_0";0
9:MasterSet ;"mycluster_0";0
10:MasterSet ;"mycluster_0";0
11:MasterSet ;"mycluster_0";0
12:MasterSet ;"mycluster_0";0
13:MasterSet ;"mycluster_0";0
14:MasterSet ;"mycluster_0";0
15:MasterSet ;"mycluster_0";0
16:MasterSet ;"mycluster_0";0
17:MasterSet ;"mycluster_0";0
18:MasterSet ;"mycluster_0";0
19:MasterSet ;"mycluster_0";0
20:MasterSet ;"mycluster_0";0
21:MasterSet ;"mycluster_0";0
22:MasterSet ;"mycluster_0";0
23:Set       ;"key1";6
24:MasterSet ;"mycluster_0";0
...
</pre>
</div>
<div class="section" id="backing-up-the-database">
<h2>Backing up the database</h2>
<p>You can perform a hot backup from a live slave node from the command line. If
you also backup the tlogs and conifguration file of the node, you have all the
required data to be able to rebuild a node. This type of backup allows you to
be able to recover from multi-node failure.</p>
<p>The backup of the database can be done by running the following command:</p>
<pre class="literal-block">
# arakoon --backup-db &lt;cluster_id&gt; &lt;ip&gt; &lt;port&gt; &lt;location&gt;
# e.g.
arakoon --backup-db ricky 127.0.0.1 7080 /mnt/drv/2011-19-07/mybackup.db
</pre>
</div>
</div>


      <footer>
      <div class='row'>
        <div class='span-one-third'>
          <p>&copy; 2011, Incubaid BVBA</p>
        </div>
        <div class='span-two-thirds'>
          <p class='pull-right'>
            <a href='../disclaimer.html'>Disclaimer</a>
            |
            <a href='../privacy_policy.html'>Privacy Policy</a>
          </p>
        </div>
      </div>
      </footer>
    </div>
  </body>
</html>