
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Arakoon :: Working with TLogs</title>
    <meta name="description"
      content="Arakoon is a distributed, consistent key-value store">
    <meta name="author" content="Incubaid BVBA">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="../bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="../style.css" rel="stylesheet" />
    <link href="../code.css" rel="stylesheet" />

    <!-- TODO
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->


  </head>

  <body class='page-documentation_working_with_tlogs'>

    <header>
    <div class="topbar">
      <div class='container'>
        <a href='index.html'>
            <img alt='Arakoon' title='Arakoon Logo' src='../img/logo.png' id='logo' />
        </a>
      </div>

      <div class="fill">
        <div class="container">
        <nav>
          <ul class="nav">
            <li>
            <a href="../index.html">Home</a>
            </li>
            <li>
            <a href="../download.html">Download</a>
            </li>
            <li>
            <a href="../documentation/index.html">Documentation</a>
            </li>
            <li>
            <a href="../contact.html">Contact</a>
            </li>
          </ul>
        </nav>
        </div>
      </div>
    </div>
    </header>

    <div class="container" id='main'>
      
<div class="document" id="working-with-tlogs">
<h1 class="title">Working with TLogs</h1>

<p>TLogs are transactions logs which keep track of all client requests to Arakoon.</p>
<div class="section" id="collapsing-tlogs">
<h2>Collapsing TLogs</h2>
<p>When the number of updates is higher than the number of additions, the
collection of TLogs keeps on growing. You can however reduce the space needed
on disk if you collapse old TLogs into a head database or token cabinet (TC).</p>
<p>Collapse the TLogs with the --collapse or --collapse-remote commands of
Arakoon.</p>
<pre class="literal-block">
arakoon --help

...
  --collapse &lt;tlog_dir&gt; &lt;n&gt; collapses n tlogs from &lt;tlog_dir&gt; into head database
  --collapse-remote &lt;cluster_id&gt; &lt;ip&gt; &lt;port&gt; &lt;n&gt; tells node to collapse &lt;n&gt; tlogs into its head database
...
</pre>
<p>For example collapse all but the four most recent TLogs of Node_2:</p>
<pre class="literal-block">
arakoon --collapse /tmp/Node_2 4

arakoon --collapse-remote Demo_Cluster 192.168.1.3 7082 4
</pre>
<p>This adds all but the four most recent TLogs into the head database. When the
TLogs are added to the main database, they are removed.</p>
<div class="section" id="difference-between-collapse-and-remote-collapse">
<h3>Difference between Collapse and Remote Collapse</h3>
<p>In a live cluster it is possible that a slave is catching up from the master.
Suppose that the master is collapsing the TLogs and removes a TLog while the
slave is at that moment catching up from that TLog. The slave then thinks that
the catchup is complete. When the slave tries to go back into normal slave
mode, he notices that he is still not in sync with the master so he goes back
into catchup mode.</p>
<p>To avoid this procedure, run the collapse as an in-process action. This way the
master detects that a catchup is running and won't delete the TLog until the
catchup has finished.</p>
<p>Use the remote collapsing to run the collapse as an in-process action. If you
run the normal collapse function, the master does not detect possible catchup
actions.</p>
</div>
</div>
<div class="section" id="disabling-tlog-compression">
<h2>Disabling TLog Compression</h2>
<p>When you have very large transaction logs, the compression of the tlog file
with 100.000 updates can consume too much CPU power so that it slows down your
whole arakoon cluster. To avoid the compression to be executed, you must add a
parameter to the Arakoon configuration file, disable_tlog_compression.</p>
<p>Add the parameter to the node section of the Arakoon configuration file on each
machine of the cluster.</p>
<pre class="literal-block">
...

[Node_0]
ip = 192.168.1.1
client_port = 7080
messaging_port = 10000
home = /tmp/Node_0
log_dir = /tmp/Node_0
log_level = debug
disable_tlog_compression = false

[Node_1]
ip = 192.168.1.2
client_port = 7081
messaging_port = 10001
home = /tmp/arakoon_1
#optional different directory for .tlog, .tlc and friends
#tlog_dir = /tmp/Node_1_tlog
log_dir = /tmp/Node_1
log_level = debug
disable_tlog_compression = true

...
</pre>
<div class="alert-message block-message warning important">
<p class="first admonition-title"><strong>Important</strong></p>
<p class="last">Make sure that you apply this change on all nodes of your cluster.</p>
</div>
</div>
</div>


      <footer>
      <div class='row'>
        <div class='span-one-third'>
          <p>&copy; 2011, Incubaid BVBA</p>
        </div>
        <div class='span-two-thirds'>
          <p class='pull-right'>
            <a href='../disclaimer.html'>Disclaimer</a>
            |
            <a href='../privacy_policy.html'>Privacy Policy</a>
          </p>
        </div>
      </div>
      </footer>
    </div>
  </body>
</html>