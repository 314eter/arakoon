
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Arakoon :: Arakoon PyLabs Client</title>
    <meta name="description"
      content="Arakoon is a distributed, consistent key-value store">
    <meta name="author" content="Incubaid BVBA">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="../../bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="../../style.css" rel="stylesheet" />
    <link href="../../code.css" rel="stylesheet" />

    <!-- TODO
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->


  </head>

  <body class='page-documentation_pylabs_arakoon_pylabs_client'>

    <header>
    <div class="topbar">
      <div class='container'>
        <a href='index.html'>
            <img alt='Arakoon' title='Arakoon Logo' src='../../img/logo.png' id='logo' />
        </a>
      </div>

      <div class="fill">
        <div class="container">
        <nav>
          <ul class="nav">
            <li>
            <a href="../../index.html">Home</a>
            </li>
            <li>
            <a href="../../download.html">Download</a>
            </li>
            <li>
            <a href="../../documentation/index.html">Documentation</a>
            </li>
            <li>
            <a href="../../contact.html">Contact</a>
            </li>
          </ul>
        </nav>
        </div>
      </div>
    </div>
    </header>

    <div class="container" id='main'>
      
<div class="document" id="arakoon-pylabs-client">
<h1 class="title">Arakoon PyLabs Client</h1>

<p>When you have set up your <a class="reference external" href="configuring_arakoon.html">Arakoon setup</a>, you can use a PyLabs client to
interact with Arakoon.</p>
<div class="section" id="connecting-to-an-arakoon-cluster">
<h2>Connecting to an Arakoon Cluster</h2>
<p>To get connect to an Arakoon cluster, you have to create the cluster
configuration and add the nodes on each machine that will run an Arakoon
client.</p>
<pre class="literal-block">
cli_cfg = q.clients.arakoon.getClientConfig('Demo_Cluster')
cli_cfg.addNode( 'Node_0', ip='192.168.1.1', clientPort=7080)
cli_cfg.addNode( 'Node_1', ip='192.168.1.2', clientPort=7081)
cli_cfg.addNode( 'Node_2', ip='192.168.1.3', clientPort=7082)
</pre>
<p>When you have created this configuration on the client machine, you can create
a connection as follows:</p>
<pre class="literal-block">
myClient = q.clients.arakoon.getClient('Demo_Cluster')

myClient.&lt;TAB&gt;
myClient.
myClient.allowDirtyReads(         myClient.prefix(
myClient.delete(                  myClient.range(
myClient.disallowDirtyReads(      myClient.range_entries(
myClient.exists(                  myClient.sequence(
myClient.expectProgressPossible(  myClient.set(
myClient.get(                     myClient.setDirtyReadNode(
myClient.getDirtyReadNode(        myClient.statistics(
myClient.hello(                   myClient.testAndSet(
myClient.multiGet(                myClient.whoMaster(
</pre>
<div class="alert-message block-message info tip">
<p class="first admonition-title"><strong>Tip</strong></p>
<p>If the client is running on one of the Arakoon machines there is a shortcut
method for generating the client configuration as follows:</p>
<pre class="last literal-block">
cli_cfg = q.clients.arakoon.getClientConfig('Demo_Cluster')
cli_cfg.generateFromServerConfig()
myClient = q.clients.arakoon.getClient('Demo_Cluster')
</pre>
</div>
</div>
<div class="section" id="doing-dirty-reads">
<h2>Doing dirty reads</h2>
<p>Starting from the 0.10.0 release of arakoon it is possible to do dirty reads
from the server node. This means that you will be reading out values which
might not be 100% up to date, i.e. the value might actually be updated on
another node (and the update will eventually be pushed to the node you are
querying). Allowing dirty reads allows clients to read data from slaves and
learner nodes.</p>
<p>To enable dirty reads issue the following command:</p>
<pre class="literal-block">
myClient.allowDirtyReads()
</pre>
<p>By default the extension will pick a random node from the nodes in the client
configuration taht will be used for dirty reads. If you want to read from a
specific node, you can override by issuing the following command:</p>
<pre class="literal-block">
myClient.setDirtyReader('Node_0')
</pre>
<p>An alternative way of doing things is to create a named client configuration
which only holds the node you want to perform dirty reads against. This can be
done like this:</p>
<pre class="literal-block">
cli_cfg = q.client.arakoon.getConfig('Demo_Cluster', 'dirty_read_cfg')
cli_cfg.addNode( 'Node_0', ip='192.168.1.1', clientPort=7080 )
dirtyReader = q.clients.arakoon.getClient( 'mindy', 'dirty_read_cfg' )
dirtyReader.allowDirtyReads()
</pre>
</div>
<div class="section" id="setting-key-value-pairs">
<h2>Setting Key-Value Pairs</h2>
<div class="section" id="normal-set-operations">
<h3>Normal set operations</h3>
<p>If we would like to add the following keys and their values:</p>
<table border="1" class="docutils"><colgroup><col width="36%"><col width="64%"></colgroup><thead valign="bottom"><tr><th class="head">Key</th>
<th class="head">Value</th>
</tr></thead><tbody valign="top"><tr><td>1</td>
<td>Value A</td>
</tr><tr><td>2</td>
<td>Value B</td>
</tr><tr><td>3</td>
<td>Value C</td>
</tr></tbody></table><p>We use the set() method as follows:</p>
<pre class="literal-block">
myClient.set('1', 'Value A')
myClient.set('2', 'Value B')
myClient.set('3', 'Value C')
</pre>
</div>
<div class="section" id="confirm">
<h3>Confirm</h3>
<p>Confirm allows you to only update key-value pairs when the new value differs
from the current value.</p>
<p>We use the confirm method as follows:</p>
<pre class="literal-block">
myClient.confirm('1', 'Value A')
myClient.confirm('2', 'Value B')
myClient.confirm('1', 'Value A')
</pre>
</div>
</div>
<div class="section" id="getting-keys-and-key-value-pairs">
<h2>Getting Keys and Key-Value Pairs</h2>
<p>This section explains how to get the value of a key, how to get the keys
between two known keys, and how to get the key-value pairs between two known
keys.</p>
<div class="section" id="getting-the-value-of-a-key">
<h3>Getting the Value of a Key</h3>
<p>To continue with the previous example, let's assume we want to retrieve that
value of key '2', in this case we would use:</p>
<div class="highlight"><pre><span class="n">myClient</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'2'</span><span class="p">)</span>
</pre></div>
<p>This returns the value for key '2'.</p>
</div>
<div class="section" id="getting-a-range-of-keys">
<h3>Getting a Range of Keys</h3>
<p>To get a range of the available keys present between two keys, we need to
specify 4 things:</p>
<ol class="arabic simple"><li>Starting key.</li>
<li>If we shall include the starting key in the result.</li>
<li>Ending key.</li>
<li>If we shall include the ending key in the result.</li>
</ol><p>So in our case, if we want know the keys that lie in the range between key '1'
and key '3', including both the starting and ending keys. In this case, we
use:</p>
<pre class="literal-block">
myClient.range('1', True, '3', True)
</pre>
<p>This returns:</p>
<pre class="literal-block">
['1', '2', '3']
</pre>
</div>
<div class="section" id="getting-a-range-of-key-value-pairs">
<h3>Getting a Range of Key-Value Pairs</h3>
<p>Similar to getting a range of keys alone, we need to specify the same four
parameters mentioned above.</p>
<p>For example, if we want to display the key-value pairs between key '1' and key
'3', excluding key '3', we use:</p>
<pre class="literal-block">
myClient.range_entries('1', True, '3', False)
</pre>
<p>This returns:</p>
<pre class="literal-block">
[('2', 'Value B'), ('1', 'Value A')]
</pre>
</div>
</div>
<div class="section" id="statistics">
<h2>Statistics</h2>
<p>Arakoon allows you to request a set of basic statistics from the master node.
To display these statistics we use:</p>
<pre class="literal-block">
myClient.statistics()
</pre>
<p>This returns:</p>
<pre class="literal-block">
{'avg_get_size': 0.0,
 'avg_set_size': 0.0,
 'del_timing': {'avg': 0.0,
                'max': 0.0,
                'min': 1.7976931348623157e+308,
                'var': 0.0},
 'get_timing': {'avg': 0.0,
                'max': 0.0,
                'min': 1.7976931348623157e+308,
                'var': 0.0},
 'last': 1307801398.8910699,
 'mget_timing': {'avg': 0.0,
                 'max': 0.0,
                 'min': 1.7976931348623157e+308,
                 'var': 0.0},
 'n_deletes': 0,
 'n_gets': 0,
 'n_multigets': 0,
 'n_ops': 0,
 'n_sequences': 0,
 'n_sets': 0,
 'n_testandsets': 0,
 'node_is': {'Node_0': 302439, 'Node_1': 302432, Node_2': 302438},
 'op_timing': {'avg': 0.0,
               'max': 0.0,
               'min': 1.7976931348623157e+308,
               'var': 0.0},
 'seq_timing': {'avg': 0.0,
                'max': 0.0,
                'min': 1.7976931348623157e+308,
                'var': 0.0},
 'set_timing': {'avg': 0.0,
                'max': 0.0,
                'min': 1.7976931348623157e+308,
                'var': 0.0},
 'start': 1307801398.8910699,
 'tas_timing': {'avg': 0.0,
                'max': 0.0,
                'min': 1.7976931348623157e+308,
                'var': 0.0}}
</pre>
<p>With these statistics, we can for example calculate the average sets per second
(since the starting of the node) using a simple formula:</p>
<pre class="literal-block">
n_sets / (last - start)
</pre>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Keep in mind that the statistics are managed by the master node; this
means that with every master switch, the statistics will be reset.</p>
</div>
</div>
<div class="section" id="collapsing-tlogs">
<h2>Collapsing TLogs</h2>
<p>See also <a class="reference external" href="../working_with_tlogs.html">Working with TLogs</a> for more information.</p>
<pre class="literal-block">
Definition: cluster.remoteCollapse(self, nodeName, n)
Documentation:
    Tell the targetted node to collapse n tlog files
</pre>
<p>To keep four TLog files on Node_2:</p>
<pre class="literal-block">
cluster.remoteCollapse(Node_2, 4)
</pre>
</div>
<div class="section" id="disabling-enabling-tlog-compression">
<h2>Disabling/Enabling TLOG Compression</h2>
<p>If you want to disable TLOG compression in your Arakoon cluster, you have to
execute the following steps on <em>each</em> node of your cluster:</p>
<pre class="literal-block">
cluster = q.manage.arakoon.getCluster('ricky')

cluster.disableTlogCompression()
</pre>
<p>By default the compression is enabled. If you have turned off the compression
and want to enable it again, use enableTlogCompression on the cluster object.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Instead of using the Q-Shell, you can directly manipulate the
[Arakoon configuration file].</p>
</div>
</div>
</div>


      <footer>
      <div class='row'>
        <div class='span-one-third'>
          <p>&copy; 2011, Incubaid BVBA</p>
        </div>
        <div class='span-two-thirds'>
          <p class='pull-right'>
            <a href='../../disclaimer.html'>Disclaimer</a>
            |
            <a href='../../privacy_policy.html'>Privacy Policy</a>
          </p>
        </div>
      </div>
      </footer>
    </div>
  </body>
</html>