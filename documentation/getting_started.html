

<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
  <title>Arakoon :: Getting Started</title>

    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Arakoon 1.0.0 documentation" href="index.html" />
    <link rel="next" title="Installing Arakoon" href="installing_arakoon.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
  <meta name="description"
    content="Arakoon is a distributed, consistent key-value store">

  <link href="_static/bootstrap.css" rel="stylesheet" />
  <link href="_static/site-style.css" rel="stylesheet" />

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27966654-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <style type='text/css'>
    footer {
      margin-top: 20px;
    }
  </style>

  </head>
  <body>
  <header>
    <div class="topbar">
      <div class='container'>
              <a href='http://arakoon.org'>
          <img alt='Arakoon' title='Arakoon Logo' src='_static/logo.png' id='logo' />
        </a>
      </div>

      <div class="fill">
        <div class="container">
        <nav>
          <ul class="nav">
            <li><a href="http://arakoon.org">Home</a></li>
            <li><a href="http://arakoon.org/download.html">Download</a></li>
            <li class="active"><a href="index.html">Documentation</a></li>
            <li><a href="http://arakoon.org/contact.html">Contact</a></li>
          </ul>
        </nav>
        </div>
      </div>
    </div>
  </header>

  <div class="container" id='main'>
    
  <div class="section" id="getting-started">
<h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This page will guide you through the setup of a 3 node Arakoon cluster.
For simplicity, all of the nodes run on 1 machine.</p>
</div>
<div class="section" id="getting-it">
<h2>Getting it<a class="headerlink" href="#getting-it" title="Permalink to this headline">¶</a></h2>
<p>The simplest is to download the archive. Other options (from source,
using Debian packages,...) exist too, but this is the easiest.</p>
<div class="highlight-python"><pre>$&gt; wget http://www.arakoon.org/downloads/arakoon-1.0.0.tgz

$&gt; tar -zxvf arakoon-1.0.0.tgz
arakoon-1.0.0/arakoon
arakoon-1.0.0/cfg/arakoon.ini

$&gt; cd arakoon-1.0.0
arakoon-1.0.0$&gt;</pre>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>An Arakoon cluster needs a config file for every node. This config file
needs to be exactly the same for every node, and for a cluster on a
single machine, all nodes can use the same file location. Here is the one
we&#8217;ll be using today:</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; cat cfg/arakoon.ini

[global]
cluster_id = ricky
cluster = arakoon_0,arakoon_1,arakoon_2

[arakoon_0]
ip = 127.0.0.1
client_port = 4000
messaging_port = 4010
home = /tmp/arakoon/arakoon_0

[arakoon_1]
ip = 127.0.0.1
client_port = 4001
messaging_port = 4011

[arakoon_2]
ip = 127.0.0.1
client_port = 4002
messaging_port = 4012</pre>
</div>
</div>
<div class="section" id="starting-the-nodes">
<h2>Starting the nodes<a class="headerlink" href="#starting-the-nodes" title="Permalink to this headline">¶</a></h2>
<p>An arakoon node will not start unless the configured directories exist.
Other things you need to provide are the name of the node, and the
location of its configuration file.</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; mkdir -p /tmp/arakoon/arakoon_0
arakoon-1.0.0$&gt; ./arakoon -config cfg/arakoon.ini --node arakoon_0</pre>
</div>
<p>In another terminal tab, start the second node. Fortunately, Arakoon
considers its default configuration location to be <strong>./cfg/arakoon.ini</strong>.</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; mkdir -p /tmp/arakoon/arakoon_1
arakoon-1.0.0$&gt; ./arakoon --node arakoon_1</pre>
</div>
<p>In yet another terminal tab, start the third node:</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; mkdir -p /tmp/arakoon/arakoon_2
arakoon-1.0.0$&gt; ./arakoon --node arakoon_2</pre>
</div>
</div>
<div class="section" id="first-steps">
<h2>First steps<a class="headerlink" href="#first-steps" title="Permalink to this headline">¶</a></h2>
<p>The arakoon binary is also an ad-hoc client, administrative too,...
We&#8217;ll show some examples below.</p>
<div class="section" id="who-s-the-master">
<h3>Who&#8217;s the master<a class="headerlink" href="#who-s-the-master" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; ./arakoon --who-master
arakoon_1</pre>
</div>
</div>
<div class="section" id="basic-set-get-delete">
<h3>Basic Set/Get/Delete<a class="headerlink" href="#basic-set-get-delete" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; ./arakoon --set some_key some_value
arakoon-1.0.0$&gt; ./arakoon --get some_key
"some_value"
arakoon-1.0.0$&gt; ./arakoon --delete some_key
arakoon-1.0.0$&gt; ./arakoon --get some_key
Fatal error: exception Arakoon_exc.Exception(5, "some_key")
Raised at file "src/core/lwt.ml", line 557, characters 22-23
Called from file "src/unix/lwt_main.ml", line 38, characters 8-18
Called from file "src/client/client_main.ml", line 68, characters 12-31
Called from file "src/main/main.ml", line 395, characters 26-37
Called from file "src/main/arakoon.ml", line 1, characters 0-12</pre>
</div>
</div>
<div class="section" id="one-node-goes-down">
<h3>One node goes down<a class="headerlink" href="#one-node-goes-down" title="Permalink to this headline">¶</a></h3>
<p>Go to the terminal tab for arakoon_0 and kill the node (<em>ctrl-c</em>).</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt; ./arakoon -config cfg/arakoon.ini --node arakoon_0
^C
arakoon-1.0.0$&gt;./arakoon --expect-progress-possible
true
arakoon-1.0.0$&gt;./arakoon --set still_alive yes
arakoon-1.0.0$&gt;./arakoon --get still_alive
"yes"</pre>
</div>
<p>You can verify the cluster still behaves properly. This is because the
<strong>majority</strong> of the nodes is just fine.</p>
</div>
<div class="section" id="inspect-transaction-logs">
<h3>Inspect transaction logs<a class="headerlink" href="#inspect-transaction-logs" title="Permalink to this headline">¶</a></h3>
<p>Arakoon keeps record of the everything you do so it can replay it to
nodes that could not follow the cluster (because they were down,
disconnected,...). This is what it looks like:</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt;./arakoon --dump-tlog /tmp/arakoon/arakoon_0/000.tlog
0:MasterSet ;"arakoon_1";0
...
5:Set       ;"some_key";10
...
12:Delete    ;"some_key"
13:MasterSet ;"arakoon_1";0
...</pre>
</div>
</div>
<div class="section" id="kill-another-node-and-whipe-it">
<h3>Kill another Node and Whipe it<a class="headerlink" href="#kill-another-node-and-whipe-it" title="Permalink to this headline">¶</a></h3>
<p>An Arakoon cluster needs to have a majority of nodes in sync to be able to have progress.
So go to the terminal tab for arakoon_1 and kill it.:</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt;./arakoon --node arakoon_1
^C
arakoon-1.0.0$&gt;./arakoon --get some_key
Fatal error: exception Failure("No Master")
Raised at file "src/core/lwt.ml", line 557, characters 22-23
Called from file "src/unix/lwt_main.ml", line 38, characters 8-18
Called from file "src/client/client_main.ml", line 68, characters 12-31
Called from file "src/main/main.ml", line 395, characters 26-37
Called from file "src/main/arakoon.ml", line 1, characters 0-12
arakoon-1.0.0$&gt;rm -rf /tmp/arakoon/arakoon_1/*
arakoon-1.0.0$&gt;./arakoon --node arakoon_1</pre>
</div>
<p>The node has been restarted.
Now go to a free tab, and try to get the value:</p>
<div class="highlight-python"><pre>arakoon-1.0.0$&gt;./arakoon --get some_key
"some_value"</pre>
</div>
<p>Arakoon nodes repair themselves using their siblings. Most of the time it&#8217;s automatic,
but sometimes they need assistence (if a database is corrupt fe)</p>
</div>
</div>
</div>


  </div>

  <div class='container'>
    <footer>
      <div class='row'>
        <div class='span-one-third'>
          <p>&copy; 2012, Incubaid BVBA</p>
        </div>
        <div class='span-two-thirds'>
          <p class='pull-right'>
            <a href='http://arakoon.org/disclaimer.html'>Disclaimer</a>
            |
            <a href='http://arakoon.org/privacy_policy.html'>Privacy Policy</a>
          </p>
        </div>
      </div>
    </footer>
  </div>

  </body>
</html>