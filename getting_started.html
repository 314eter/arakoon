
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Arakoon :: Getting Started</title>
    <meta name="description"
      content="Arakoon is a distributed, consistent key-value store">
    <meta name="author" content="Incubaid BVBA">

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="bootstrap/bootstrap.css" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />

    <!-- TODO
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->


  </head>

  <body class='page-getting_started'>

    <header>
    <div class="topbar">
      <div class='container'>
        <img alt='Arakoon' title='Arakoon Logo' src='img/logo.png' id='logo' />
      </div>

      <div class="fill">
        <div class="container">
        <nav>
          <ul class="nav">
            <li>
              <a href="index.html">Home</a>
            </li>
            <li>
              <a href="download.html">Download</a>
            </li>
            <li>
              <a href="documentation.html">Documentation</a>
            </li>
            <li>
              <a href="contact.html">Contact</a>
            </li>
          </ul>
        </nav>
        </div>
      </div>
    </div>
    </header>

    <div class="container" id='main'>
      

<div class="document" id="getting-started">
<h1 class="title">Getting Started</h1>

<p>
</p>
<div class="section" id="introduction">
<h2>Introduction</h2>
<p>This page will guide you through the setup of a 3 node Arakoon cluster.
For simplicity, all of the nodes run on 1 machine.</p>
</div>
<div class="section" id="getting-it">
<h2>Getting it</h2>
<p>The simplest is to download the archive. Other options (from source,
using Debian packages,...) exist too, but this is the easiest.</p>
<pre class="literal-block">
$&gt; wget http://www.arakoon.org/downloads/arakoon-1.0.0.tgz

$&gt; tar -zxvf arakoon-1.0.0.tgz
arakoon-1.0.0/arakoon
arakoon-1.0.0/cfg/arakoon.ini

$&gt; cd arakoon-1.0.0
arakoon-1.0.0$&gt;
</pre>
</div>
<div class="section" id="configuration">
<h2>Configuration</h2>
<p>An Arakoon cluster needs a config file for every node. This config file
needs to be exactly the same for every node, and for a cluster on a
single machine, all nodes can use the same file location. Here is the one
we'll be using today:</p>
<pre class="literal-block">
arakoon-1.0.0$&gt; cat cfg/arakoon.ini

[global]
cluster_id = ricky
cluster = arakoon_0,arakoon_1,arakoon_2

[arakoon_0]
ip = 127.0.0.1
client_port = 4000
messaging_port = 4010
home = /tmp/arakoon/arakoon_0

[arakoon_1]
ip = 127.0.0.1
client_port = 4001
messaging_port = 4011

[arakoon_2]
ip = 127.0.0.1
client_port = 4002
messaging_port = 4012
</pre>
</div>
<div class="section" id="starting-the-nodes">
<h2>Starting the nodes</h2>
<p>An arakoon node will not start unless the configured directories exist.
Other things you need to provide are the name of the node, and the
location of its configuration file.</p>
<pre class="literal-block">
arakoon-1.0.0$&gt; mkdir -p /tmp/arakoon/arakoon_0
arakoon-1.0.0$&gt; ./arakoon -config cfg/arakoon.ini --node arakoon_0
</pre>
<p>In another terminal tab, start the second node. Fortunately, Arakoon
considers its default configuration location to be <strong>./cfg/arakoon.ini</strong>.</p>
<pre class="literal-block">
arakoon-1.0.0$&gt; mkdir -p /tmp/arakoon/arakoon_1
arakoon-1.0.0$&gt; ./arakoon --node arakoon_1
</pre>
<p>In yet another terminal tab, start the third node:</p>
<pre class="literal-block">
arakoon-1.0.0$&gt; mkdir -p /tmp/arakoon/arakoon_2
arakoon-1.0.0$&gt; ./arakoon --node arakoon_2
</pre>
</div>
<div class="section" id="first-steps">
<h2>First steps</h2>
<p>The arakoon binary is also an ad-hoc client, administrative too,...
We'll show some examples below.</p>
<div class="section" id="who-s-the-master">
<h3>Who's the master</h3>
<pre class="literal-block">
arakoon-1.0.0$&gt; ./arakoon --who-master
arakoon_1
</pre>
</div>
<div class="section" id="basic-set-get-delete">
<h3>Basic Set/Get/Delete</h3>
<pre class="literal-block">
arakoon-1.0.0$&gt; ./arakoon --set some_key some_value
arakoon-1.0.0$&gt; ./arakoon --get some_key
&quot;some_value&quot;
arakoon-1.0.0$&gt; ./arakoon --delete some_key
arakoon-1.0.0$&gt; ./arakoon --get some_key
Fatal error: exception Arakoon_exc.Exception(5, &quot;some_key&quot;)
Raised at file &quot;src/core/lwt.ml&quot;, line 557, characters 22-23
Called from file &quot;src/unix/lwt_main.ml&quot;, line 38, characters 8-18
Called from file &quot;src/client/client_main.ml&quot;, line 68, characters 12-31
Called from file &quot;src/main/main.ml&quot;, line 395, characters 26-37
Called from file &quot;src/main/arakoon.ml&quot;, line 1, characters 0-12
</pre>
</div>
<div class="section" id="one-node-goes-down">
<h3>One node goes down</h3>
<p>Go to the terminal tab for arakoon_0 and kill the node (<em>ctrl-c</em>).</p>
<pre class="literal-block">
arakoon-1.0.0$&gt; ./arakoon -config cfg/arakoon.ini --node arakoon_0
^C
arakoon-1.0.0$&gt;./arakoon --expect-progress-possible
true
arakoon-1.0.0$&gt;./arakoon --set still_alive yes
arakoon-1.0.0$&gt;./arakoon --get still_alive
&quot;yes&quot;
</pre>
<p>You can verify the cluster still behaves properly. This is because the
<strong>majority</strong> of the nodes is just fine.</p>
</div>
<div class="section" id="inspect-transaction-logs">
<h3>Inspect transaction logs</h3>
<p>Arakoon keeps record of the everything you do so it can replay it to
nodes that could not follow the cluster (because they were down,
disconnected,...). This is what it looks like:</p>
<pre class="literal-block">
arakoon-1.0.0$&gt;./arakoon --dump-tlog /tmp/arakoon/arakoon_0/000.tlog
0:MasterSet ;&quot;arakoon_1&quot;;0
...
5:Set       ;&quot;some_key&quot;;10
...
12:Delete    ;&quot;some_key&quot;
13:MasterSet ;&quot;arakoon_1&quot;;0
...
</pre>
</div>
<div class="section" id="kill-another-node-and-whipe-it">
<h3>Kill another Node and Whipe it</h3>
<p>An Arakoon cluster needs to have a majority of nodes in sync to be able to have progress.
So go to the terminal tab for arakoon_1 and kill it.:</p>
<pre class="literal-block">
arakoon-1.0.0$&gt;./arakoon --node arakoon_1
^C
arakoon-1.0.0$&gt;./arakoon --get some_key
Fatal error: exception Failure(&quot;No Master&quot;)
Raised at file &quot;src/core/lwt.ml&quot;, line 557, characters 22-23
Called from file &quot;src/unix/lwt_main.ml&quot;, line 38, characters 8-18
Called from file &quot;src/client/client_main.ml&quot;, line 68, characters 12-31
Called from file &quot;src/main/main.ml&quot;, line 395, characters 26-37
Called from file &quot;src/main/arakoon.ml&quot;, line 1, characters 0-12
arakoon-1.0.0$&gt;rm -rf /tmp/arakoon/arakoon_1/*
arakoon-1.0.0$&gt;./arakoon --node arakoon_1
</pre>
<p>The node has been restarted.
Now go to a free tab, and try to get the value:</p>
<pre class="literal-block">
arakoon-1.0.0$&gt;./arakoon --get some_key
&quot;some_value&quot;
</pre>
<p>Arakoon nodes repair themselves using their siblings. Most of the time it's automatic,
but sometimes they need assistence (if a database is corrupt fe)</p>
</div>
</div>
</div>


      <footer>
      <div class='row'>
        <div class='span-one-third'>
          <p>&copy; 2011, Incubaid BVBA</p>
        </div>
        <div class='span-two-thirds'>
          <p class='pull-right'>
            <a href='disclaimer.html'>Disclaimer</a>
            |
            <a href='privacy_policy.html'>Privacy Policy</a>
          </p>
        </div>
      </div>
      </footer>
    </div>
  </body>
</html>